<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta name='Author' content='ActiveState'>
<link rel='stylesheet' type='text/css' href='../../aspn.css'>
<title>Tcl Library Procedures - TclZlib manual page</title>
<link rel="stylesheet" href="../docs.css" type="text/css" media=
"all">
</head>
<body>
<div class="banner">
<table width="100%" border="0" cellspacing="0" cellpadding="3">
<tr>
<td align="left"><a target="_blank" href=
"http://www.activestate.com/activetcl"><img src=
"../../images/ActiveTcl.gif" border="0" align="left" alt=
"ActiveTcl"></a> </td>
<td align="center" class="heading">ActiveTcl User Guide</td>
<td align="right"><a target="_blank" href=
"http://www.activestate.com"><img src="../../images/AS_logo.gif"
border="0" align="right" alt="ActiveState Software Inc."></a> </td>
</tr>
</table>
</div>

<br>
<h2><a href="../contents.htm">Tcl/Tk Documentation</a>
<small>&gt;</small> <a href="contents.htm">TclLib</a>
<small>&gt;</small> TclZlib</h2>

<h3><a href="../UserCmd/contents.htm">Tcl/Tk Applications</a> | <a
href="../TclCmd/contents.htm">Tcl Commands</a> | <a href=
"../TkCmd/contents.htm">Tk Commands</a> | <a href=
"../TclLib/contents.htm">Tcl Library</a> | <a href=
"../TkLib/contents.htm">Tk Library</a></h3>

<dl>
<dd><a href="TclZlib.htm#M2" name="L810">NAME</a> 

<dl>
<dd>Tcl_ZlibAdler32, Tcl_ZlibCRC32, Tcl_ZlibDeflate,
Tcl_ZlibInflate, Tcl_ZlibStreamChecksum, Tcl_ZlibStreamClose,
Tcl_ZlibStreamEof, Tcl_ZlibStreamGet, Tcl_ZlibStreamGetCommandName,
Tcl_ZlibStreamInit, Tcl_ZlibStreamPut - compression and
decompression functions</dd>
</dl>
</dd>

<dd><a href="TclZlib.htm#M3" name="L811">SYNOPSIS</a></dd>

<dd><a href="TclZlib.htm#M4" name="L812">ARGUMENTS</a></dd>

<dd><a href="TclZlib.htm#M5" name="L813">DESCRIPTION</a></dd>

<dd><a href="TclZlib.htm#M6" name="L814">ZLIB STREAMS</a></dd>

<dd><a href="TclZlib.htm#M7" name="L815">GZIP OPTIONS
DICTIONARY</a> 

<dl class="gzip options dictionary">
<dd><a href="TclZlib.htm#M8" name="L816"><b>comment</b></a></dd>

<dd><a href="TclZlib.htm#M9" name="L817"><b>crc</b></a></dd>

<dd><a href="TclZlib.htm#M10" name="L818"><b>filename</b></a></dd>

<dd><a href="TclZlib.htm#M11" name="L819"><b>os</b></a></dd>

<dd><a href="TclZlib.htm#M12" name="L820"><b>size</b></a></dd>

<dd><a href="TclZlib.htm#M13" name="L821"><b>time</b></a></dd>

<dd><a href="TclZlib.htm#M14" name="L822"><b>type</b></a></dd>
</dl>
</dd>

<dd><a href="TclZlib.htm#M15" name="L823">PORTABILITY
NOTES</a></dd>

<dd><a href="TclZlib.htm#M16" name="L824">SEE ALSO</a></dd>

<dd><a href="TclZlib.htm#M17" name="L825">KEYWORDS</a></dd>
</dl>

<h3><a name="M2">NAME</a></h3>

Tcl_ZlibAdler32, Tcl_ZlibCRC32, Tcl_ZlibDeflate, Tcl_ZlibInflate,
Tcl_ZlibStreamChecksum, Tcl_ZlibStreamClose, Tcl_ZlibStreamEof,
Tcl_ZlibStreamGet, Tcl_ZlibStreamGetCommandName,
Tcl_ZlibStreamInit, Tcl_ZlibStreamPut - compression and
decompression functions 

<h3><a name="M3">SYNOPSIS</a></h3>

#include &lt;tcl.h&gt;<br>
int<br>
<b>Tcl_ZlibDeflate</b>(<i>interp, format, dataObj, level,
dictObj</i>)<br>
int<br>
<b>Tcl_ZlibInflate</b>(<i>interp, format, dataObj, dictObj</i>)<br>
unsigned int<br>
<b>Tcl_ZlibCRC32</b>(<i>initValue, bytes, length</i>)<br>
unsigned int<br>
<b>Tcl_ZlibAdler32</b>(<i>initValue, bytes, length</i>)<br>
int<br>
<b>Tcl_ZlibStreamInit</b>(<i>interp, mode, format, level, dictObj,
zshandlePtr</i>)<br>
Tcl_Obj *<br>
<b>Tcl_ZlibStreamGetCommandName</b>(<i>zshandle</i>)<br>
int<br>
<b>Tcl_ZlibStreamEof</b>(<i>zshandle</i>)<br>
int<br>
<b>Tcl_ZlibStreamClose</b>(<i>zshandle</i>)<br>
int<br>
<b>Tcl_ZlibStreamReset</b>(<i>zshandle</i>)<br>
int<br>
<b>Tcl_ZlibStreamChecksum</b>(<i>zshandle</i>)<br>
int<br>
<b>Tcl_ZlibStreamPut</b>(<i>zshandle, dataObj, flush</i>)<br>
int<br>
<b>Tcl_ZlibStreamGet</b>(<i>zshandle, dataObj, count</i>)<br>
<b>Tcl_ZlibStreamSetCompressionDictionary</b>(<i>zshandle,
compDict</i>)<br>
<h3><a name="M4">ARGUMENTS</a></h3>

<dl class="arguments">
<dt><a href="../TclLib/Interp.htm">Tcl_Interp</a> <b>*interp</b>
(in)</dt>

<dd>The interpreter to store resulting compressed or uncompressed
data in. Also where any error messages are written. For
<b>Tcl_ZlibStreamInit</b>, this can be NULL to create a stream that
is not bound to a command.</dd>

<dt>int <b><a href="../TclCmd/format.htm">format</a></b> (in)</dt>

<dd>What format of compressed data to work with. Must be one of
<b>TCL_ZLIB_FORMAT_ZLIB</b> for zlib-format data,
<b>TCL_ZLIB_FORMAT_GZIP</b> for gzip-format data, or
<b>TCL_ZLIB_FORMAT_RAW</b> for raw compressed data. In addition,
for decompression only, <b>TCL_ZLIB_FORMAT_AUTO</b> may also be
chosen which can automatically detect whether the compressed data
was in zlib or gzip format.</dd>

<dt>Tcl_Obj <b>*dataObj</b> (in/out)</dt>

<dd>A byte-array value containing the data to be compressed or
decompressed, or to which the data extracted from the stream is
appended when passed to <b>Tcl_ZlibStreamGet</b>.</dd>

<dt>int <b>level</b> (in)</dt>

<dd>What level of compression to use. Should be a number from 0 to
9 or one of the following: <b>TCL_ZLIB_COMPRESS_NONE</b> for no
compression, <b>TCL_ZLIB_COMPRESS_FAST</b> for fast but inefficient
compression, <b>TCL_ZLIB_COMPRESS_BEST</b> for slow but maximal
compression, or <b>TCL_ZLIB_COMPRESS_DEFAULT</b> for the level
recommended by the zlib library.</dd>

<dt>Tcl_Obj <b>*dictObj</b> (in/out)</dt>

<dd>A dictionary that contains, or which will be updated to
contain, a description of the gzip header associated with the
compressed data. Only useful when the <i>format</i> is
<b>TCL_ZLIB_FORMAT_GZIP</b> or <b>TCL_ZLIB_FORMAT_AUTO</b>. If a
NULL is passed, a default header will be used on compression and
the header will be ignored (apart from integrity checks) on
decompression. See the section <b>GZIP OPTIONS DICTIONARY</b> for
details about the contents of this dictionary.</dd>

<dt>unsigned int <b>initValue</b> (in)</dt>

<dd>The initial value for the checksum algorithm.</dd>

<dt>unsigned char <b>*bytes</b> (in)</dt>

<dd>An array of bytes to run the checksum algorithm over, or NULL
to get the recommended initial value for the checksum
algorithm.</dd>

<dt>int <b>length</b> (in)</dt>

<dd>The number of bytes in the array.</dd>

<dt>int <b>mode</b> (in)</dt>

<dd>What mode to operate the stream in. Should be either
<b>TCL_ZLIB_STREAM_DEFLATE</b> for a compressing stream or
<b>TCL_ZLIB_STREAM_INFLATE</b> for a decompressing stream.</dd>

<dt>Tcl_ZlibStream <b>*zshandlePtr</b> (out)</dt>

<dd>A pointer to a variable in which to write the abstract token
for the stream upon successful creation.</dd>

<dt>Tcl_ZlibStream <b>zshandle</b> (in)</dt>

<dd>The abstract token for the stream to operate on.</dd>

<dt>int <b><a href="../TclCmd/flush.htm">flush</a></b> (in)</dt>

<dd>Whether and how to flush the stream after writing the data to
it. Must be one of: <b>TCL_ZLIB_NO_FLUSH</b> if no flushing is to
be done, <b>TCL_ZLIB_FLUSH</b> if the currently compressed data
must be made available for access using <b>Tcl_ZlibStreamGet</b>,
<b>TCL_ZLIB_FULLFLUSH</b> if the stream must be put into a state
where the decompressor can recover from on corruption, or
<b>TCL_ZLIB_FINALIZE</b> to ensure that the stream is finished and
that any trailer demanded by the format is written.</dd>

<dt>int <b>count</b> (in)</dt>

<dd>The maximum number of bytes to get from the stream, or -1 to
get all remaining bytes from the stream's buffers.</dd>

<dt>Tcl_Obj <b>*compDict</b> (in)</dt>

<dd>A byte array value that is the compression dictionary to use
with the stream. Note that this is <i>not a Tcl dictionary</i>, and
it is recommended that this only ever be used with streams that
were created with their <i>format</i> set to
<b>TCL_ZLIB_FORMAT_ZLIB</b> because the other formats have no
mechanism to indicate whether a compression dictionary was present
other than to fail on decompression.</dd>
</dl>

<h3><a name="M5">DESCRIPTION</a></h3>

These functions form the interface from the Tcl library to the Zlib
library by Jean-loup Gailly and Mark Adler. 

<p><b>Tcl_ZlibDeflate</b> and <b>Tcl_ZlibInflate</b> respectively
compress and decompress the data contained in the <i>dataObj</i>
argument, according to the <i>format</i> and, for compression,
<i>level</i> arguments. The dictionary in the <i>dictObj</i>
parameter is used to convey additional header information about the
compressed data when the compression format supports it; currently,
the dictionary is only used when the <i>format</i> parameter is
<b>TCL_ZLIB_FORMAT_GZIP</b> or <b>TCL_ZLIB_FORMAT_AUTO</b>. For
details of the contents of the dictionary, see the <b>GZIP OPTIONS
DICTIONARY</b> section below. Upon success, both functions leave
the resulting compressed or decompressed data in a byte-array value
that is the Tcl interpreter's result; the returned value is a
standard Tcl result code.</p>

<p><b>Tcl_ZlibAdler32</b> and <b>Tcl_ZlibCRC32</b> compute
checksums on arrays of bytes, returning the computed checksum.
Checksums are computed incrementally, allowing data to be processed
one block at a time, but this requires the caller to maintain the
current checksum and pass it in as the <i>initValue</i> parameter;
the initial value to use for this can be obtained by using NULL for
the <i>bytes</i> parameter instead of a pointer to the array of
bytes to compute the checksum over. Thus, typical usage in the
single data block case is like this:</p>

<pre>
checksum = <b>Tcl_ZlibCRC32</b>(<b>Tcl_ZlibCRC32</b>(0,NULL,0), data, length);
</pre>

<p>Note that the Adler-32 algorithm is not a real checksum, but
instead is a related type of hash that works best on longer
data.</p>

<h4><a name="M6">ZLIB STREAMS</a></h4>

<b>Tcl_ZlibStreamInit</b> creates a compressing or decompressing
stream that is linked to a Tcl command, according to its arguments,
and provides an abstract token for the stream and returns a normal
Tcl result code; <b>Tcl_ZlibStreamGetCommandName</b> returns the
name of that command given the stream token, or NULL if the stream
has no command. Streams are not designed to be thread-safe; each
stream should only ever be used from the thread that created it.
When working with gzip streams, a dictionary (fields as given in
the <b>GZIP OPTIONS DICTIONARY</b> section below) can be given via
the <i>dictObj</i> parameter that on compression allows control
over the generated headers, and on decompression allows discovery
of the existing headers. Note that the dictionary will be written
to on decompression once sufficient data has been read to have a
complete header. This means that the dictionary must be an unshared
value in that case; a blank value created with <b><a href=
"../TclLib/Object.htm">Tcl_NewObj</a></b> is suggested. 

<p>Once a stream has been constructed, <b>Tcl_ZlibStreamPut</b> is
used to add data to the stream and <b>Tcl_ZlibStreamGet</b> is used
to retrieve data from the stream after processing. Both return
normal Tcl result codes and leave an error message in the result of
the interpreter that the stream is registered with in the error
case (if such a registration has been performed). With
<b>Tcl_ZlibStreamPut</b>, the data buffer value passed to it should
not be modified afterwards. With <b>Tcl_ZlibStreamGet</b>, the data
buffer value passed to it will have the data bytes appended to it.
Internally to the stream, data is kept compressed so as to minimize
the cost of buffer space.</p>

<p><b>Tcl_ZlibStreamChecksum</b> returns the checksum computed over
the uncompressed data according to the format, and
<b>Tcl_ZlibStreamEof</b> returns a boolean value indicating whether
the end of the uncompressed data has been reached.</p>

<p><b>Tcl_ZlibStreamSetCompressionDictionary</b> is used to control
the compression dictionary used with the stream, a compression
dictionary being an array of bytes (such as might be created with
<b><a href="../TclLib/ByteArrObj.htm">Tcl_NewByteArrayObj</a></b>)
that is used to initialize the compression engine rather than
leaving it to create it on the fly from the data being compressed.
Setting a compression dictionary allows for more efficient
compression in the case where the start of the data is highly
regular, but it does require both the compressor and the
decompressor to agreee on the value to use. Compression
dictionaries are only fully supported for zlib-format data; on
compression, they must be set before any data is sent in with
<b>Tcl_ZlibStreamPut</b>, and on decompression they should be set
when <b>Tcl_ZlibStreamGet</b> produces an <b><a href=
"../TclCmd/error.htm">error</a></b> with its <b>-errorcode</b> set
to &ldquo;<b>ZLIB NEED_DICT</b> <i>code</i>&rdquo;; the <i>code</i>
will be the Adler-32 checksum (see <b>Tcl_ZlibAdler32</b>) of the
compression dictionary sought. (Note that this is only true for
zlib-format streams; gzip streams ignore compression dictionaries
as the format specification doesn't permit them, and raw streams
just produce a data error if the compression dictionary is missing
or incorrect.)</p>

<p>If you wish to clear a stream and reuse it for a new compression
or decompression action, <b>Tcl_ZlibStreamReset</b> will do this
and return a normal Tcl result code to indicate whether it was
successful; if the stream is registered with an interpreter, an
error message will be left in the interpreter result when this
function returns TCL_ERROR. Finally, <b>Tcl_ZlibStreamClose</b>
will clean up the stream and delete the associated command: using
<b><a href="../TclLib/CrtObjCmd.htm">Tcl_DeleteCommand</a></b> on
the stream's command is equivalent (when such a command
exists).</p>

<h3><a name="M7">GZIP OPTIONS DICTIONARY</a></h3>

The <i>dictObj</i> parameter to <b>Tcl_ZlibDeflate</b>,
<b>Tcl_ZlibInflate</b> and <b>Tcl_ZlibStreamInit</b> is used to
pass a dictionary of options about that is used to describe the
gzip header in the compressed data. When creating compressed data,
the dictionary is read and when unpacking compressed data the
dictionary is written (in which case the <i>dictObj</i> parameter
must refer to an unshared dictionary value). 

<p>The following fields in the dictionary value are understood. All
other fields are ignored. No field is required when creating a
gzip-format stream.</p>

<dl class="gzip options dictionary">
<dt><a name="M8"><b>comment</b></a></dt>

<dd>This holds the comment field of the header, if present. If
absent, no comment was supplied (on decompression) or will be
created (on compression).</dd>

<dt><a name="M9"><b>crc</b></a></dt>

<dd>A boolean value describing whether a CRC of the header is
computed. Note that the <b>gzip</b> program does <i>not</i> use or
allow a CRC on the header.</dd>

<dt><a name="M10"><b>filename</b></a></dt>

<dd>The name of the file that held the uncompressed data. This
should not contain any directory separators, and should be
sanitized before use on decompression with <b><a href=
"../TclCmd/file.htm">file tail</a></b>.</dd>

<dt><a name="M11"><b>os</b></a></dt>

<dd>The operating system type code field from the header (if not
the &ldquo;unknown&rdquo; value). See RFC 1952 for the meaning of
these codes. On compression, if this is absent then the field will
be set to the &ldquo;unknown&rdquo; value.</dd>

<dt><a name="M12"><b>size</b></a></dt>

<dd>The size of the uncompressed data. This is ignored on
compression; the size of the data compressed depends on how much
data is supplied to the compression engine.</dd>

<dt><a name="M13"><b>time</b></a></dt>

<dd>The time field from the header if non-zero, expected to be the
time that the file named by the <b><a href=
"../TclCmd/filename.htm">filename</a></b> field was modified.
Suitable for use with <b>clock format</b>. On creation, the right
value to use is that from <b>clock seconds</b> or <b><a href=
"../TclCmd/file.htm">file mtime</a></b>.</dd>

<dt><a name="M14"><b>type</b></a></dt>

<dd>The type of the uncompressed data (either <b><a href=
"../TclCmd/binary.htm">binary</a></b> or <b><a href=
"../TkCmd/text.htm">text</a></b>) if known.</dd>
</dl>

<h3><a name="M15">PORTABILITY NOTES</a></h3>

These functions will fail gracefully if Tcl is not linked with the
zlib library. 

<h3><a name="M16">SEE ALSO</a></h3>

<b><a href="../TclLib/ByteArrObj.htm">Tcl_NewByteArrayObj</a></b>,
<b><a href="../TclCmd/zlib.htm">zlib</a></b> 

<h3><a name="M17">KEYWORDS</a></h3>

<a href="../Keywords/C.htm#compress">compress</a>, <a href=
"../Keywords/D.htm#decompress">decompress</a>, <a href=
"../Keywords/D.htm#deflate">deflate</a>, <a href=
"../Keywords/G.htm#gzip">gzip</a>, <a href=
"../Keywords/I.htm#inflate">inflate</a> 

<div class="copy">Copyright &copy; 1995-1997 Roger E. Critchlow Jr.
Copyright &copy; 2008 Donal K. Fellows</div>
</body>
</html>

