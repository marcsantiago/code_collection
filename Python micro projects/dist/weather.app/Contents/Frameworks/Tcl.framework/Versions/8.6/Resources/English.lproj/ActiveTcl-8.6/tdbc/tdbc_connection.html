<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- manual page source format generated by PolyglotMan v3.0.8+X.Org, -->
<!-- available at http://polyglotman.sourceforge.net/ -->
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta name='Author' content='ActiveState'>
<link rel='stylesheet' type='text/css' href='../aspn.css'>
<title>TDBC tdbc_connection</title>
</head>
<body>
<div class="banner">
<table width="100%" border="0" cellspacing="0" cellpadding="3">
<tr>
<td align="left"><a target="_blank" href=
"http://www.activestate.com/activetcl"><img src=
"../images/ActiveTcl.gif" border="0" align="left" alt="ActiveTcl">
</a> </td>
<td align="center" class="heading">ActiveTcl User Guide</td>
<td align="right"><a target="_blank" href=
"http://www.activestate.com"><img src="../images/AS_logo.gif"
border="0" align="right" alt="ActiveState Software Inc."></a> </td>
</tr>
</table>
</div>

<br>
<a href='#toc'>Table of Contents</a> 

<p>
______________________________________________________________________________</p>

<h2><a name='sect0' href='#toc0'><b>Name</b></a></h2>

<p>tdbc::connection - TDBC connection object</p>

<h2><a name='sect1' href='#toc1'><b>Synopsis</b></a></h2>

<p>package require <b>tdbc</b> <b>1.0</b><br>
 package require <b>tdbc::</b><i>driver</i> <i>version</i></p>

<p><b>tdbc::</b><i>driver</i><b>::connection</b> <b>create</b>
<i>db</i> ?<i>-option</i> <i>value</i>...?</p>

<p><i>db</i> <b>configure</b> ?<i>-option</i> <i>value</i>...?<br>
 <i>db</i> <b>close</b><br>
 <i>db</i> <b>foreignkeys</b> ?<i>-primary</i> <i>tableName</i>?
?<i>-foreign</i> <i>tableName</i>? <i>db</i> <b>prepare</b>
<i>sql-code</i><br>
 <i>db</i> <b>preparecall</b> <i>call</i><br>
 <i>db</i> <b>primarykeys</b> <i>tableName</i><br>
 <i>db</i> <b>statements</b><br>
 <i>db</i> <b>resultsets</b><br>
 <i>db</i> <b>tables</b> ?<i>pattern</i>?<br>
 <i>db</i> <b>columns</b> <i>table</i> ?<i>pattern</i>?<br>
 <i>db</i> <b>begintransaction</b><br>
 <i>db</i> <b>commit</b><br>
 <i>db</i> <b>rollback</b><br>
 <i>db</i> <b>transaction</b> <i>script</i><br>
 <i>db</i> <b>allrows</b> ?<b>-as</b> <b>lists</b>|<b>dicts</b>?
?<b>-columnsvariable</b> <i>name</i>? ?<b>--</b>? <i>sql-code</i>
?<i>dictionary</i>?<br>
 <i>db</i> <b>foreach</b> ?<b>-as</b> <b>lists</b>|<b>dicts</b>?
?<b>-columnsvariable</b> <i>name</i>? ?--? <i>varName</i>
<i>sql-code</i> ?<i>dictionary</i>? <i>script</i>
_________________________________________________________________</p>

<h2><a name='sect2' href='#toc2'><b>Description</b></a></h2>

<p>Every database driver for TDBC (Tcl DataBase Connectivity)
implements a <i>connection</i> object that represents a connection
to a database. By con-vention, this object is created by the
command, <b>tdbc::</b><i>driver</i><b>::connec-tion</b>
<b>create</b>. This command accepts the name of a Tcl command that
will represent the connection and a possible set of options (see
<b>CONFIGURA-TION</b> <b>OPTIONS</b>). It establishes a connection
to the database and returns the name of the newly-created Tcl
command.</p>

<p>The <b>configure</b> object command on a database connection, if
presented with no arguments, returns a list of alternating keywords
and values representing the connection&acirc;&euro;&trade;s current
configuration. If presented with a single argument <i>-option</i>,
it returns the configured value of the given option. Otherwise, it
must be given an even number of arguments which are alternating
options and values. The specified options receive the specified
values, and nothing is returned.</p>

<p>The <b>close</b> object command on a database connection closes
the connec-tion. All active statements and result sets on the
connection are closed. Any uncommitted transaction is rolled back.
The object command is deleted.</p>

<p>The <b>prepare</b> object command on a database connection
prepares a SQL statement for execution. The <i>sql-code</i>
argument must contain a single SQL statement to be executed. Bound
variables may be included. The return value is a newly-created Tcl
command that represents the state-ment. See <b>tdbc::statement</b>
for more detailed discussion of the SQL accepted by the
<b>prepare</b> object command and the interface accepted by a
statement.</p>

<p>On a database connection where the underlying database and
driver support stored procedures, the <b>preparecall</b> object
command prepares a call to a stored procedure for execution. The
syntax of the stored procedure call is:</p>

<p>?<i>resultvar</i> =? <i>procname</i>(?<i>arg</i> ?,
<i>arg</i>...?)</p>

<p>The return value is a newly-created Tcl command that represents
the statement. See <b>tdbc::statement</b> for the interface
accepted by a state-ment.</p>

<p>The <b>statements</b> object command returns a list of
statements that have been created by <b>prepare</b> and
<b>preparecall</b> statements against the given connection and have
not yet been closed.</p>

<p>The <b>resultsets</b> object command returns a list of result
sets that have been obtained by executing statements prepared using
the given connec-tion and not yet closed.</p>

<p>The <b>tables</b> object command allows the program to query the
connection for the names of tables that exist in the database. The
optional <i>pat-tern</i> parameter is a pattern to match the name
of a table. It may con-tain the SQL wild-card characters
&acirc;&euro;&trade;<b>%</b>&acirc;&euro;&trade; and and whose
values are subdic-tionaries. See the documentation for the
individual database driver for the interpretation of the
values.</p>

<p>The <b>columns</b> object command allows the program to query
the connection for the names of columns that exist in a given
table. The optional <b>pattern</b> parameter is a pattern to match
the name of a column. It may contain the SQL wild-card characters
&acirc;&euro;&trade;<b>%</b>&acirc;&euro;&trade; and and whose
values are dic-tionaries. Each of the subdictionaries will contain
at least the fol-lowing keys and values (and may contain others
whose usage is deter-mined by a specific database driver).</p>

<p><b>type</b> Contains the data type of the column, and will
generally be cho-sen from the set, <b>bigint</b>, <b>binary</b>,
<b>bit</b>, <b>char</b>, <b>date</b>, <b>decimal</b>,
<b>dou-ble</b>, <b>float</b>, <b>integer</b>, <b>longvarbinary</b>,
<b>longvarchar</b>, <b>numeric</b>, <b>real</b>, <b>time</b>,
<b>timestamp</b>, <b>smallint</b>, <b>tinyint</b>,
<b>varbinary</b>, and <b>varchar</b>. (If the column has a type
that cannot be represented as one of the above, <b>type</b> will
contain a driver-dependent description of the type.)</p>

<p><b>precision</b><br>
 Contains the precision of the column in bits, decimal digits, or
the width in characters, according to the type.</p>

<p><b>scale</b> Contains the scale of the column (the number of
digits after the radix point), for types that support the
concept.</p>

<p><b>nullable</b><br>
 Contains 1 if the column can contain NULL values, and 0
other-wise.</p>

<p>The <b>primarykeys</b> object command allows the program to
query the connec-tion for the primary keys belonging to a given
table. The <i>tableName</i> parameter identifies the table being
interrogated. The result is a list of dictionaries enumerating the
keys (in a similar format to the list returned by
<i>$connection</i> <b>allrows</b> <b>-as</b> <b>dicts</b>). The
keys of the dictionary may include at least the following. Values
that are NULL or meaningless in a given database are omitted.</p>

<p><b>tableCatalog</b><br>
 Name of the catalog in which the table appears.</p>

<p><b>tableSchema</b><br>
 Name of the schema in which the table appears.</p>

<p><b>tableName</b><br>
 Name of the table owning the primary key.</p>

<p><b>constraintCatalog</b><br>
 Name of the catalog in which the primary key constraint appears.
In some database systems, this may not be the same as the
ta-ble&acirc;&euro;&trade;s catalog.</p>

<p><b>constraintSchema</b><br>
 Name of the schema in which the primary key constraint appears. In
some database systems, this may not be the same as the
ta-ble&acirc;&euro;&trade;s schema.</p>

<p><b>constraintName</b><br>
 Name of the primary key constraint,</p>

<p><b>columnName</b><br>
 Name of a column that is a member of the primary key.</p>

<p><b>ordinalPosition</b><br>
 Ordinal position of the column within the primary key.</p>

<p>To these columns may be added additional ones that are specific
to a particular database system.</p>

<p>The <b>foreignkeys</b> object command allows the program to
query the connec-tion for foreign key relationships that apply to a
particular table. The relationships may be constrained to the keys
that appear in a par-ticular table (<b>-foreign</b>
<i>tableName</i>), the keys that refer to a particular table
(<b>-primary</b> <i>tableName</i>), or both. At least one of
<b>-primary</b> and <b>-foreign</b> should be specified, although
some drivers will enumerate all foreign keys in the current catalog
if both options are omitted. The result of the <b>foreignkeys</b>
object command is a list of dictionaries, with one list element per
key (in a similar format to the list returned by <i>$connection</i>
<b>allrows</b> <b>-as</b> <b>dicts</b>). The keys of the dictionary
may include at least the following. Values that are NULL or
meaningless in a given database are omitted.</p>

<p><b>foreignConstraintCatalog</b><br>
 Catalog in which the foreign key constraint appears.</p>

<p><b>foreignConstraintSchema</b><br>
 Schema in which the foreign key constraint appears.</p>

<p><b>foreignConstraintName</b><br>
 Name of the foreign key constraint.</p>

<p><b>primaryConstraintCatalog</b><br>
 Catalog holding the primary key constraint (or unique key
con-straint) on the column to which the foreign key refers.</p>

<p><b>primaryConstraintSchema</b><br>
 Schema holding the primary key constraint (or unique key
con-straint) on the column to which the foreign key refers.</p>

<p><b>primaryConstraintName</b><br>
 Name of the primary key constraint (or unique key constraint) on
the column to which the foreign key refers.</p>

<p><b>updateAction</b><br>
 Action to take when an UPDATE statement invalidates the
con-straint. The value will be <b>CASCADE</b>, <b>SET</b>
<b>DEFAULT</b>, <b>SET</b> <b>NULL</b>, <b>RESTRICT</b>, or
<b>NO</b> <b>ACTION</b>.</p>

<p><b>deleteAction</b><br>
 Action to take when a DELETE statement invalidates the
con-straint. The value will be <b>CASCADE</b>, <b>SET</b>
<b>DEFAULT</b>, <b>SET</b> <b>NULL</b>, <b>RESTRICT</b>, or
<b>NO</b> <b>ACTION</b>.</p>

<p><b>primaryCatalog</b><br>
 Catalog name in which the primary table (the one to which the
foreign key refers) appears.</p>

<p><b>primarySchema</b><br>
 Schema name in which the primary table (the one to which the
foreign key refers) appears.</p>

<p><b>primaryTable</b><br>
 Table name of the primary table (the one to which the foreign key
refers).</p>

<p><b>primaryColumn</b><br>
 Name of the column to which the foreign key refers.</p>

<p><b>foreignCatalog</b><br>
 Name of the catalog in which the table containing the foreign key
appears.</p>

<p><b>foreignSchema</b><br>
 Name of the schema in which the table containing the foreign key
appears.</p>

<p><b>foreignTable</b><br>
 Name of the table containing the foreign key.</p>

<p><b>foreignColumn</b><br>
 Name of the column appearing in the foreign key.</p>

<p><b>ordinalPosition</b><br>
 Position of the column in the foreign key, if the key is a
com-pound key.</p>

<p>The <b>begintransaction</b> object command on a database
connection begins a transaction on the database. If the underlying
database does not sup-port atomic, consistent, isolated, durable
transactions, the <b>begin-transaction</b> object command returns
an error reporting the fact. Simi-larly, if multiple
<b>begintransaction</b> commands are executed withough an
intervening <b>commit</b> or <b>rollback</b> command, an error is
returned unless the underlying database supports nested
transactions.</p>

<p>The <b>commit</b> object command on a database connection ends
the most recent transaction started by <b>begintransaction</b> and
commits changes to the database.</p>

<p>The <b>rollback</b> object command on a database connection
rolls back the most recent transaction started by
<b>begintransaction</b>. The state of the database is as if nothing
happened during the transaction.</p>

<p>The <b>transaction</b> object command on a database connection
presents a sim-ple way of bundling a database transaction. It
begins a transaction, and evaluates the supplied <i>script</i>
argument as a Tcl script in the caller&acirc;&euro;&trade;s scope.
If <i>script</i> terminates normally, or by <b>break</b>,
<b>continue</b>, or <b>return</b>, the transaction is committed
(and any action requested by <b>break</b>, <b>continue</b>, or
<b>return</b> takes place). If the commit fails for any reason, the
error in the commit is treated as an error in the <i>script</i>. In
the case of an error in <i>script</i> or in the commit, the
transaction is rolled back and the error is rethrown. Any
nonstandard return code from the script causes the transaction to
be rolled back and then is rethrown.</p>

<p>The <b>allrows</b> object command prepares a SQL statement
(given by the <i>sql-code</i> parameter) to execute against the
database. It then executes it (see <b>tdbc::statement</b> for
details) with the optional <i>dictionary</i> parameter giving bind
variables. Finally, it uses the <i>allrows</i> object command on
the result set (see <b>tdbc::resultset</b>) to construct a list of
the results. Finally, both result set and statement are closed. The
return value is the list of results.</p>

<p>The <b>foreach</b> object command prepares a SQL statement
(given by the <i>sql-code</i> parameter) to execute against the
database. It then executes it (see <b>tdbc::statement</b> for
details) with the optional <i>dictionary</i> parame-ter giving bind
variables. Finally, it uses the <i>foreach</i> object command on
the result set (see <b>tdbc::resultset</b>) to evaluate the given
<i>script</i> for each row of the results. Finally, both result set
and statement are closed, even if the given <i>script</i> results
in a <b>return</b>, an error, or an unusual return code.</p>

<h2><a name='sect3' href='#toc3'><b>Configuration</b>
<b>Options</b></a></h2>

<p>The configuration options accepted when the connection is
created and on the connection&acirc;&euro;&trade;s <b>configure</b>
object command include the following, and may include others
specific to a database driver.</p>

<dl>
<dt><b>-encoding</b> <i>name</i></dt>

<dd>Specifies the encoding to be used in connecting to the
database. The <i>name</i> should be one of the names accepted by
the <b>encoding</b> command. This option is usually unnecessary;
most database drivers can figure out the encoding in use by
themselves.</dd>

<dt><b>-isolation</b> <i>level</i></dt>

<dd>Specifies the transaction isolation level needed for
transac-tions on the database. The acceptable values for
<i>level</i> are shown under <b>TRANSACTION</b> <b>ISOLATION</b>
<b>LEVELS</b>.</dd>

<dt><b>-timeout</b> <i>ms</i></dt>

<dd>Specifies the maximum time to wait for a an operation database
engine before reporting an error to the caller. The <i>ms</i>
argument gives the maximum time in milliseconds. A value of zero
(the default) specifies that the calling process is to wait
indefi-nitely for database operations.</dd>

<dt><b>-readonly</b> <i>flag</i></dt>

<dd>Specifies that the connection will not modify the database (if
the Boolean parameter <i>flag</i> is true), or that it may modify
the database (if <i>flag</i> is false). If <i>flag</i> is true,
this option may have the effect of raising the transaction
isolation level to <i>readonly</i>.</dd>
</dl>

<p><b>TRANSACTION</b> <b>ISOLATION</b> <b>LEVELS</b><br>
 The acceptable values for the <b>-isolation</b> configuration
option are as follows:</p>

<p><b>readuncommitted</b><br>
 Allows the transaction to read dirty", that is, uncommitted data.
This isolation level may compromise data integrity, does not
guarantee that foreign keys or uniqueness constraints are
satisfied, and in general does not guarantee data consistency.</p>

<p><b>readcommitted</b><br>
 Forbids the transaction from reading dirty data, but does not
guarantee repeatable reads; if a transaction reads a row of a
database at a given time, there is no guarantee that the same row
will be available at a later time in the same transaction.</p>

<p><b>repeatableread</b><br>
 Guarantees that any row of the database, once read, will have the
same values for the life of a transaction. Still permits phantom
reads (that is, newly-added rows appearing if a table is queried a
second time).</p>

<p><b>serializable</b><br>
 The most restrictive (and most expensive) level of transaction
isolation. Any query to the database, if repeated, will return
precisely the same results for the life of the transaction, exactly
as if the transaction is the only user of the database.</p>

<p><b>readonly</b><br>
 Behaves like <b>serializable</b> in that the only results visible
to the transaction are those that were committed prior to the start
of the transaction, but forbids the transaction from modifying the
database.</p>

<p>A database that does not implement one of these isolation levels
will instead use the next more restrictive isolation level. If the
given level of isolation cannot be obtained, the database interface
throws an error reporting the fact. The default isolation level is
<b>readcommitted</b>.</p>

<p>A script should not the isolation level when a transaction is in
progress.</p>

<h2><a name='sect4' href='#toc4'><b>See</b> <b>Also</b></a></h2>

<p><a href='encoding.n.html'>encoding(n)</a> , <a href=
'tdbc.n.html'>tdbc(n)</a> , <a href=
'tdbc::resultset.n.html'>tdbc::resultset(n)</a> , <a href=
'tdbc::statement.n.html'>tdbc::statement(n)</a> , <a href=
'tdbc::tokenize.n.html'>tdbc::tokenize(n)</a></p>

<h2><a name='sect5' href='#toc5'><b>Keywords</b></a></h2>

<p>TDBC, SQL, database, connectivity, connection, resultset,
statement</p>

<h2><a name='sect6' href='#toc6'><b>Copyright</b></a></h2>

<p>Copyright (c) 2008 by Kevin B. Kenny.</p>

<h2><a name='sect7' href='#toc7'>Tcl 8.6 <a href=
'tdbc::connection.n.html'>tdbc::connection(n)</a></a></h2>

<hr>
<p><a name='toc'><b>Table of Contents</b></a></p>

<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>

<li><a name='toc1' href='#sect1'>Synopsis</a></li>

<li><a name='toc2' href='#sect2'>Description</a></li>

<li><a name='toc3' href='#sect3'>Configuration Options</a></li>

<li><a name='toc4' href='#sect4'>See Also</a></li>

<li><a name='toc5' href='#sect5'>Keywords</a></li>

<li><a name='toc6' href='#sect6'>Copyright</a></li>

<li><a name='toc7' href='#sect7'>Tcl 8.6
tdbc::connection(n)</a></li>
</ul>
</body>
</html>

