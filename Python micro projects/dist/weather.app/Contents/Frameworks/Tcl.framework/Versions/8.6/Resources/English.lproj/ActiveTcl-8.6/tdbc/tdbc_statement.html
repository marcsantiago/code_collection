<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- manual page source format generated by PolyglotMan v3.0.8+X.Org, -->
<!-- available at http://polyglotman.sourceforge.net/ -->
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta name='Author' content='ActiveState'>
<link rel='stylesheet' type='text/css' href='../aspn.css'>
<title>TDBC tdbc_statement</title>
</head>
<body>
<div class="banner">
<table width="100%" border="0" cellspacing="0" cellpadding="3">
<tr>
<td align="left"><a target="_blank" href=
"http://www.activestate.com/activetcl"><img src=
"../images/ActiveTcl.gif" border="0" align="left" alt="ActiveTcl">
</a> </td>
<td align="center" class="heading">ActiveTcl User Guide</td>
<td align="right"><a target="_blank" href=
"http://www.activestate.com"><img src="../images/AS_logo.gif"
border="0" align="right" alt="ActiveState Software Inc."></a> </td>
</tr>
</table>
</div>

<br>
<a href='#toc'>Table of Contents</a> 

<p>
______________________________________________________________________________</p>

<h2><a name='sect0' href='#toc0'><b>Name</b></a></h2>

<p>tdbc::statement - TDBC statement object</p>

<h2><a name='sect1' href='#toc1'><b>Synopsis</b></a></h2>

<p>package require <b>tdbc</b> <b>1.0</b><br>
 package require <b>tdbc::</b><i>driver</i> <i>version</i></p>

<p><b>tdbc::</b><i>driver</i><b>::connection</b> <b>create</b>
<i>db</i> <i>?-option</i> <i>value</i>...?</p>

<p><b>set</b> <i>stmt</i> <b>[</b><i>db</i> <b>prepare</b>
<i>sql-code</i><b>]</b><br>
 <b>set</b> <i>stmt</i> <b>[</b><i>db</i> <b>preparecall</b>
<i>call</i><b>]</b></p>

<p><i>$stmt</i> <b>params</b><br>
 <i>$stmt</i> <b>paramtype</b> ?<i>direction</i>? <i>type</i>
?<i>precision</i>? ?<i>scale</i>? <i>$stmt</i> <b>execute</b>
?<i>dict</i>?<br>
 <i>$stmt</i> <b>resultsets</b><br>
 <i>$stmt</i> <b>allrows</b> ?<b>-as</b> <b>lists|dicts</b>?
?<b>-columnsvariable</b> <i>name</i>? ?<b>--</b>? ?<i>dict</i>
<i>$stmt</i> <b>foreach</b> ?<b>-as</b> <b>lists|dicts</b>?
?<b>-columnsvariable</b> <i>name</i>? ?<b>--</b>? <i>varName</i>
?<i>dict</i>? <i>script</i><br>
 <i>$stmt</i> <b>close</b><br>
 _________________________________________________________________</p>

<h2><a name='sect2' href='#toc2'><b>Description</b></a></h2>

<p>Every database driver for TDBC (Tcl DataBase Connectivity)
implements a <i>statement</i> object that represents a SQL
statement in a database. Instances of this object are created by
executing the <b>prepare</b> or <b>pre-parecall</b> object command
on a database connection.</p>

<p>The <b>prepare</b> object command against the connection accepts
arbitrary SQL code to be executed against the database. The SQL
code may contain <i>bound</i> <i>variables</i>, which are strings
of alphanumeric characters or under-scores (the first character of
the string may not be numeric), prefixed with a colon (<b>:</b>).
If a bound variable appears in the SQL statement, and is not in a
string set off by single or double quotes, nor in a comment
introduced by <b>--</b>, it becomes a value that is substituted
when the statement is executed. A bound variable becomes a single
value (string or numeric) in the resulting statement.
<i>Drivers</i> <i>are</i> <i>responsible</i> <i>for</i>
<i>ensuring</i> <i>that</i> <i>the</i> <i>mechanism</i> <i>for</i>
<i>binding</i> <i>variables</i> <i>prevents</i> <i>SQL</i>
<i>injec-tion.</i></p>

<p>The <b>preparecall</b> object command against the connection
accepts a styl-ized statement in the form:</p>

<p><i>procname</i> <b>(</b>?<b>:</b><i>varname</i>?
?<b>,:</b><i>varname</i>...?<b>)</b></p>

<p>or</p>

<p><i>varname</i> <b>=</b> <i>procname</i>
<b>(</b>?<b>:</b><i>varname</i>?
?<b>,:</b><i>varname</i>...?<b>)</b></p>

<p>This statement represents a call to a stored procedure
<i>procname</i> in the database. The variable name to the left of
the equal sign (if present), and all variable names that are
parameters inside parentheses, become bound variables.</p>

<p>The <b>params</b> method against a statement object enumerates
the bound vari-ables that appear in the statement. The result
returned from the <b>params</b> method is a dictionary whose keys
are the names of bound variables (listed in the order in which the
variables first appear in the state-ment), and whose values are
dictionaries. The subdictionaries include at least the following
keys (database drivers may add additional keys that are not in this
list).</p>

<p><b>direction</b><br>
 Contains one of the keywords, <b>in</b>, <b>out</b> or
<b>inout</b> according to whether the variable is an input to or
output from the state-ment. Only stored procedure calls will have
<b>out</b> or <b>inout</b> parame-ters.</p>

<p><b>type</b> Contains the data type of the column, and will
generally be cho-sen from the set, <b>bigint</b>, <b>binary</b>,
<b>bit</b>, <b>char</b>, <b>date</b>, <b>decimal</b>,
<b>dou-ble</b>, <b>float</b>, <b>integer</b>, <b>longvarbinary</b>,
<b>longvarchar</b>, <b>numeric</b>, <b>real</b>, <b>time</b>,
<b>timestamp</b>, <b>smallint</b>, <b>tinyint</b>,
<b>varbinary</b>, and <b>varchar</b>. (If the variable has a type
that cannot be represented as one of the above, <b>type</b> will
contain a driver-dependent description of the type.)</p>

<p><b>precision</b><br>
 Contains the precision of the column in bits, decimal digits, or
the width in characters, according to the type.</p>

<p><b>scale</b> Contains the scale of the column (the number of
digits after the radix point), for types that support the
concept.</p>

<p><b>nullable</b><br>
 Contains 1 if the column can contain NULL values, and 0
other-wise.</p>

<p>The <b>paramtype</b> object command allows the script to specify
the type and direction of parameter transmission of a variable in a
statement. (Some databases provide no method to determine this
information automatically and place the burden on the caller to do
so.) The <i>direction</i>, <i>type</i>, <i>pre-cision</i>,
<i>scale</i>, and <i>nullable</i> arguments have the same meaning
as the cor-responding dictionary values in the <b>params</b> object
command.</p>

<p>The <b>execute</b> object command executes the statement. Prior
to executing the statement, values are provided for the bound
variables that appear in it. If the <i>dict</i> parameter is
supplied, it is searched for a key whose name matches the name of
the bound variable. If the key is present, its value becomes the
substituted variable. If not, the value of the substituted variable
becomes a SQL NULL. If the <i>dict</i> parameter is <i>not</i>
supplied, the <b>execute</b> object command searches for a variable
in the caller&acirc;&euro;&trade;s scope whose name matches the
name of the bound variable. If one is found, its value becomes the
bound variable&acirc;&euro;&trade;s value. If none is found, the
bound variable is assigned a SQL NULL as its value. Once
substitution is finished, the resulting statement is executed. The
return value is a result set object (see <b>tdbc::resultset</b> for
details).</p>

<p>The <b>resultsets</b> method returns a list of all the result
sets that have been returned by executing the statement and have
not yet been closed.</p>

<p>The <b>allrows</b> object command executes the statement as with
the <b>execute</b> object command, accepting an optional
<i>dict</i> parameter giving bind vari-ables. After executing the
statement, it uses the <i>allrows</i> object com-mand on the result
set (see <b>tdbc::resultset</b>) to construct a list of the
results. Finally, the result set is closed. The return value is the
list of results.</p>

<p>The <b>foreach</b> object command executes the statement as with
the <b>execute</b> object command, accepting an optional
<i>dict</i> parameter giving bind vari-ables. After executing the
statement, it uses the <i>foreach</i> object com-mand on the result
set (see <b>tdbc::resultset</b>) to evaluate the given
<i>script</i> for each row of the results. Finally, the result set
is closed, even if the given <i>script</i> results in a
<b>return</b>, an error, or an unusual return code.</p>

<p>The <b>close</b> object command removes a statement and any
result sets that it has created. All system resources associated
with the objects are freed.</p>

<h2><a name='sect3' href='#toc3'><b>Examples</b></a></h2>

<p>The following code would look up a telephone number in a
directory, assuming an appropriate SQL schema:</p>

<p>package require tdbc::sqlite3<br>
 tdbc::sqlite3::connection create db phonebook.sqlite3 set
statement [db prepare {<br>
 select phone_num from directory where first_name = :firstname and
last_name = :lastname }]<br>
 set firstname Fred<br>
 set lastname Flintstone<br>
 $statement foreach row {<br>
 puts [dict get $row phone_num] }<br>
 $statement close<br>
 db close</p>

<h2><a name='sect4' href='#toc4'><b>See</b> <b>Also</b></a></h2>

<p><a href='encoding.n.html'>encoding(n)</a> , <a href=
'tdbc.n.html'>tdbc(n)</a> , <a href=
'tdbc::connection.n.html'>tdbc::connection(n)</a> , <a href=
'tdbc::resultset.n.html'>tdbc::resultset(n)</a> , <a href=
'tdbc::tokenize.n.html'>tdbc::tokenize(n)</a></p>

<h2><a name='sect5' href='#toc5'><b>Keywords</b></a></h2>

<p>TDBC, SQL, database, connectivity, connection, resultset,
statement, bound variable, stored procedure, call</p>

<h2><a name='sect6' href='#toc6'><b>Copyright</b></a></h2>

<p>Copyright (c) 2008 by Kevin B. Kenny.</p>

<h2><a name='sect7' href='#toc7'>Tcl 8.6 <a href=
'tdbc::statement.n.html'>tdbc::statement(n)</a></a></h2>

<hr>
<p><a name='toc'><b>Table of Contents</b></a></p>

<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>

<li><a name='toc1' href='#sect1'>Synopsis</a></li>

<li><a name='toc2' href='#sect2'>Description</a></li>

<li><a name='toc3' href='#sect3'>Examples</a></li>

<li><a name='toc4' href='#sect4'>See Also</a></li>

<li><a name='toc5' href='#sect5'>Keywords</a></li>

<li><a name='toc6' href='#sect6'>Copyright</a></li>

<li><a name='toc7' href='#sect7'>Tcl 8.6
tdbc::statement(n)</a></li>
</ul>
</body>
</html>

